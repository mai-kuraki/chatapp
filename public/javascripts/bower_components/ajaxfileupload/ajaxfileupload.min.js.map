{"version":3,"sources":["ajaxfileupload.js"],"names":["jQuery","extend","createUploadIframe","id","uri","frameId","window","ActiveXObject","io","document","createElement","src","name","style","position","top","left","body","appendChild","createUploadForm","fileElementId","data","formId","fileId","form","oldElement","newElement","clone","files","attr","before","appendTo","i","$","css","handleError","s","xhr","status","e","error","call","context","global","event","trigger","ajaxFileUpload","ajaxSettings","secureuri","active","requestDone","xml","uploadCallback","isTimeout","getElementById","contentWindow","responseText","innerHTML","responseXML","XMLDocument","contentDocument","uploadHttpData","dataType","success","complete","unbind","setTimeout","remove","timeout","url","encoding","enctype","submit","attachEvent","addEventListener","abort","r","type","globalEval","eval","html","evalScripts"],"mappings":"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","file":"ajaxfileupload.min.js","sourcesContent":["// JavaScript Document\njQuery.extend({\n\n    createUploadIframe: function (id, uri) {\n        //create frame\n        var frameId = 'jUploadFrame' + id;\n\n        if (window.ActiveXObject) {\n            var io = document.createElement('<iframe id=\"' + frameId + '\" name=\"' + frameId + '\" />');\n            if (typeof uri == 'boolean') {\n                io.src = 'javascript:false';\n            }\n            else if (typeof uri == 'string') {\n                io.src = uri;\n            }\n        }\n        else {\n            var io = document.createElement('iframe');\n            io.id = frameId;\n            io.name = frameId;\n        }\n        io.style.position = 'absolute';\n        io.style.top = '-1000px';\n        io.style.left = '-1000px';\n\n        document.body.appendChild(io);\n\n        return io;\n    },\n    createUploadForm: function (id, fileElementId, data) {\n        //create form\n        var formId = 'jUploadForm' + id;\n        var fileId = 'jUploadFile' + id;\n        var form = jQuery('<form  action=\"\" method=\"POST\" name=\"' + formId + '\" id=\"' + formId + '\" enctype=\"multipart/form-data\"></form>');\n        var oldElement = jQuery('#' + fileElementId);\n        var newElement = jQuery(oldElement).clone();\n        newElement[0].files=oldElement[0].files;\n        jQuery(oldElement).attr('id', fileId);\n        jQuery(oldElement).before(newElement);\n        jQuery(oldElement).appendTo(form);\n\n\n        //add data\n        if (data) {\n            for (var i in data) {\n                $('<input type=\"hidden\" name=\"' + i + '\" value=\"' + data[i] + '\" />').appendTo(form);\n            }\n        }\n        //set attributes\n        jQuery(form).css('position', 'absolute');\n        jQuery(form).css('top', '-1200px');\n        jQuery(form).css('left', '-1200px');\n        jQuery(form).appendTo('body');\n        return form;\n    },\n\n    handleError: function( s, xhr, status, e ) \t\t{\n        // If a local callback was specified, fire it\n        if ( s.error ) {\n            s.error.call( s.context || s, xhr, status, e );\n        }\n\n        // Fire the global callback\n        if ( s.global ) {\n            (s.context ? jQuery(s.context) : jQuery.event).trigger( \"ajaxError\", [xhr, s, e] );\n        }\n    },\n\n    ajaxFileUpload: function (s) {\n        // TODO introduce global settings, allowing the client to modify them for all requests, not only timeout  \n        s = jQuery.extend({}, jQuery.ajaxSettings, s);\n        var id = s.fileElementId;\n        var form = jQuery.createUploadForm(id, s.fileElementId, s.data);\n        var io = jQuery.createUploadIframe(id, s.secureuri);\n        var frameId = 'jUploadFrame' + id;\n        var formId = 'jUploadForm' + id;\n\n        if (s.global && !jQuery.active++) {\n            // Watch for a new set of requests\n            jQuery.event.trigger(\"ajaxStart\");\n        }\n        var requestDone = false;\n        // Create the request object\n        var xml = {};\n        if (s.global) {\n            jQuery.event.trigger(\"ajaxSend\", [xml, s]);\n        }\n\n        var uploadCallback = function (isTimeout) {\n            // Wait for a response to come back\n            var io = document.getElementById(frameId);\n            try {\n                if (io.contentWindow) {\n                    xml.responseText = io.contentWindow.document.body ? io.contentWindow.document.body.innerHTML : null;\n                    xml.responseXML = io.contentWindow.document.XMLDocument ? io.contentWindow.document.XMLDocument : io.contentWindow.document;\n\n                } else if (io.contentDocument) {\n                    xml.responseText = io.contentDocument.document.body ? io.contentDocument.document.body.innerHTML : null;\n                    xml.responseXML = io.contentDocument.document.XMLDocument ? io.contentDocument.document.XMLDocument : io.contentDocument.document;\n                }\n            } catch (e) {\n                jQuery.handleError(s, xml, null, e);\n            }\n            if (xml || isTimeout == \"timeout\") {\n                requestDone = true;\n                var status;\n                try {\n                    status = isTimeout != \"timeout\" ? \"success\" : \"error\";\n                    // Make sure that the request was successful or notmodified\n                    if (status != \"error\") {\n                        // process the data (runs the xml through httpData regardless of callback)\n                        var data = jQuery.uploadHttpData(xml, s.dataType);\n                        if (s.success) {\n                            // ifa local callback was specified, fire it and pass it the data\n                            s.success(data, status);\n                        }\n                        ;\n                        if (s.global) {\n                            // Fire the global callback\n                            jQuery.event.trigger(\"ajaxSuccess\", [xml, s]);\n                        }\n                        ;\n                    } else {\n                        jQuery.handleError(s, xml, status);\n                    }\n\n                } catch (e) {\n                    status = \"error\";\n                    jQuery.handleError(s, xml, status, e);\n                }\n                ;\n                if (s.global) {\n                    // The request was completed\n                    jQuery.event.trigger(\"ajaxComplete\", [xml, s]);\n                }\n                ;\n\n\n                // Handle the global AJAX counter\n                if (s.global && !--jQuery.active) {\n                    jQuery.event.trigger(\"ajaxStop\");\n                }\n                ;\n                if (s.complete) {\n                    s.complete(xml, status);\n                }\n                ;\n\n                jQuery(io).unbind();\n\n                setTimeout(function () {\n                    try {\n                        jQuery(io).remove();\n                        jQuery(form).remove();\n\n                    } catch (e) {\n                        jQuery.handleError(s, xml, null, e);\n                    }\n\n                }, 100);\n\n                xml = null;\n\n            }\n            ;\n        }\n        // Timeout checker\n        if (s.timeout > 0) {\n            setTimeout(function () {\n\n                if (!requestDone) {\n                    // Check to see ifthe request is still happening\n                    uploadCallback(\"timeout\");\n                }\n\n            }, s.timeout);\n        }\n        try {\n            var form = jQuery('#' + formId);\n            jQuery(form).attr('action', s.url);\n            jQuery(form).attr('method', 'POST');\n            jQuery(form).attr('target', frameId);\n            if (form.encoding) {\n                form.encoding = 'multipart/form-data';\n            }\n            else {\n                form.enctype = 'multipart/form-data';\n            }\n            jQuery(form).submit();\n\n        } catch (e) {\n            jQuery.handleError(s, xml, null, e);\n        }\n        if (window.attachEvent) {\n            document.getElementById(frameId).attachEvent('onload', uploadCallback);\n        }\n        else {\n            document.getElementById(frameId).addEventListener('load', uploadCallback, false);\n        }\n        return {\n            abort: function () {\n            }\n        };\n\n    },\n\n    uploadHttpData: function (r, type) {\n        var data = !type;\n        data = type == \"xml\" || data ? r.responseXML : r.responseText;\n        // ifthe type is \"script\", eval it in global context\n        if (type == \"script\") {\n            jQuery.globalEval(data);\n        }\n\n        // Get the JavaScript object, ifJSON is used.\n        if (type == \"json\") {\n            eval(\"data = \" + data);\n        }\n\n        // evaluate scripts within html\n        if (type == \"html\") {\n            jQuery(\"<div>\").html(data).evalScripts();\n        }\n\n        return data;\n    }\n});\n"],"sourceRoot":"/source/"}